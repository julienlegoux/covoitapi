{
	"info": {
		"name": "CovoitAPI",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"description": "Carpooling REST API — Full integration test suite with RBAC-aware flow.\n\nFlow: Register → Login → Profile → Create Driver (upgrade to DRIVER) → Re-Login → CRUD operations → Cleanup"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{ "key": "token", "value": "{{token}}", "type": "string" }
		]
	},
	"variable": [
		{ "key": "apiBase", "value": "https://covoitapi-git-develop-julien-legouxs-projects.vercel.app/api" },
		{ "key": "baseUrl", "value": "https://covoitapi-git-develop-julien-legouxs-projects.vercel.app/api/v1" },
		{ "key": "bypassToken", "value": "iTJZ9hSQOcbj55DWU5fgA67szmg1G4h5" },
		{ "key": "token", "value": "" },
		{ "key": "userId", "value": "" },
		{ "key": "testEmail", "value": "" },
		{ "key": "brandId", "value": "" },
		{ "key": "cityId", "value": "" },
		{ "key": "colorId", "value": "" },
		{ "key": "carId", "value": "" },
		{ "key": "driverId", "value": "" },
		{ "key": "travelId", "value": "" },
		{ "key": "inscriptionId", "value": "" },
		{ "key": "adminEmail", "value": "admin@covoitapi.test" },
		{ "key": "adminPassword", "value": "AdminPassword1" },
		{ "key": "adminToken", "value": "" }
	],
	"event": [
		{
			"listen": "test",
			"script": {
				"exec": [
					"if (pm.response.code !== 204) {",
					"    pm.test('Response is JSON', function () {",
					"        pm.expect(pm.response.headers.get('Content-Type')).to.include('json');",
					"    });",
					"}",
					"",
					"pm.test('Response time < 5s', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});"
				],
				"type": "text/javascript"
			}
		}
	],
	"item": [
		{
			"name": "Health",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('API is healthy', function () {",
									"    const res = pm.response.json();",
									"    pm.expect(res.status).to.eql('ok');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "GET",
						"header": [
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{apiBase}}/health",
							"host": ["{{apiBase}}"],
							"path": ["health"]
						}
					}
				}
			]
		},
		{
			"name": "Auth",
			"item": [
				{
					"name": "Register",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const uniqueEmail = 'test_' + Date.now() + '@example.com';",
									"pm.collectionVariables.set('testEmail', uniqueEmail);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 201 - User created', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Response contains token', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('token');",
									"    pm.expect(data.token).to.be.a('string').and.not.empty;",
									"});",
									"",
									"pm.test('Response contains userId', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('userId');",
									"    pm.expect(data.userId).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data) {",
									"    if (res.data.token) pm.collectionVariables.set('token', res.data.token);",
									"    if (res.data.userId) pm.collectionVariables.set('userId', res.data.userId);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{testEmail}}\",\n\t\"password\": \"Password1\",\n\t\"confirmPassword\": \"Password1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "register"]
						}
					}
				},
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - Login successful', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Response contains token', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('token');",
									"    pm.expect(data.token).to.be.a('string').and.not.empty;",
									"});",
									"",
									"pm.test('Response contains userId', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('userId');",
									"    pm.expect(data.userId).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data) {",
									"    if (res.data.token) pm.collectionVariables.set('token', res.data.token);",
									"    if (res.data.userId) pm.collectionVariables.set('userId', res.data.userId);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{testEmail}}\",\n\t\"password\": \"Password1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						}
					}
				},
				{
					"name": "Login - Invalid credentials (expect 401)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 401 - Invalid credentials', function () {",
									"    pm.response.to.have.status(401);",
									"});",
									"",
									"pm.test('Response has success:false', function () {",
									"    pm.expect(pm.response.json().success).to.eql(false);",
									"});",
									"",
									"pm.test('Error code is INVALID_CREDENTIALS', function () {",
									"    pm.expect(pm.response.json().error.code).to.eql('INVALID_CREDENTIALS');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{testEmail}}\",\n\t\"password\": \"WrongPassword1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						}
					}
				},
				{
					"name": "Register - Duplicate (expect 409)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 409 - User already exists', function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test('Response has success:false', function () {",
									"    pm.expect(pm.response.json().success).to.eql(false);",
									"});",
									"",
									"pm.test('Error code is USER_ALREADY_EXISTS', function () {",
									"    pm.expect(pm.response.json().error.code).to.eql('USER_ALREADY_EXISTS');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{testEmail}}\",\n\t\"password\": \"Password1\",\n\t\"confirmPassword\": \"Password1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "register"]
						}
					}
				}
			]
		},
		{
			"name": "User (USER role)",
			"item": [
				{
					"name": "Complete Profile (PATCH /me)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - Profile updated', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"firstName\": \"Jean\",\n\t\"lastName\": \"Dupont\",\n\t\"phone\": \"0612345678\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users/me",
							"host": ["{{baseUrl}}"],
							"path": ["users", "me"]
						}
					}
				},
				{
					"name": "Get User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Data contains user fields', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('id');",
									"    pm.expect(data).to.have.property('email');",
									"    pm.expect(data.id).to.eql(pm.collectionVariables.get('userId'));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/users/{{userId}}",
							"host": ["{{baseUrl}}"],
							"path": ["users", "{{userId}}"]
						}
					}
				},
				{
					"name": "List Users (expect 403 - ADMIN only)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 403 - Requires ADMIN role', function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test('Response has success:false', function () {",
									"    pm.expect(pm.response.json().success).to.eql(false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/users?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["users"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				}
			]
		},
		{
			"name": "Become Driver",
			"description": "Create a driver profile to upgrade role from USER to DRIVER, then re-login to obtain a new JWT with DRIVER permissions.",
			"item": [
				{
					"name": "Create Driver",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const license = 'PERM-' + Date.now();",
									"pm.collectionVariables.set('driverLicense', license);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 201 - Driver created', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Data contains driver id', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('id');",
									"    pm.expect(data.id).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.id) pm.collectionVariables.set('driverId', res.data.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"driverLicense\": \"{{driverLicense}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/drivers",
							"host": ["{{baseUrl}}"],
							"path": ["drivers"]
						}
					}
				},
				{
					"name": "Re-Login (get DRIVER token)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - Re-login successful', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Response contains new token', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('token');",
									"    pm.expect(data.token).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.token) {",
									"    pm.collectionVariables.set('token', res.data.token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{testEmail}}\",\n\t\"password\": \"Password1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						}
					}
				}
			]
		},
		{
			"name": "City",
			"item": [
				{
					"name": "Create City",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 201 - City created', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Data contains city id', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('id');",
									"    pm.expect(data.id).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.id) pm.collectionVariables.set('cityId', res.data.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"cityName\": \"Paris\",\n\t\"zipcode\": \"75000\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/cities",
							"host": ["{{baseUrl}}"],
							"path": ["cities"]
						}
					}
				},
				{
					"name": "List Cities",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is a non-empty array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array').and.not.empty;",
									"});",
									"",
									"pm.test('Pagination meta is present', function () {",
									"    const meta = pm.response.json().data.meta;",
									"    pm.expect(meta).to.have.property('page');",
									"    pm.expect(meta).to.have.property('limit');",
									"    pm.expect(meta).to.have.property('total');",
									"    pm.expect(meta).to.have.property('totalPages');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/cities?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["cities"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				}
			]
		},
		{
			"name": "Brand (RBAC)",
			"description": "Brand creation requires ADMIN. Test that DRIVER gets 403 on create, but can list existing brands.",
			"item": [
				{
					"name": "Create Brand (expect 403 - ADMIN only)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 403 - Requires ADMIN role', function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test('Response has success:false', function () {",
									"    pm.expect(pm.response.json().success).to.eql(false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"Renault\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/brands",
							"host": ["{{baseUrl}}"],
							"path": ["brands"]
						}
					}
				},
				{
					"name": "List Brands",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is an array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array');",
									"});",
									"",
									"// Save first brand ID for car creation",
									"const res = pm.response.json();",
									"if (res.data && res.data.data && res.data.data.length > 0) {",
									"    pm.collectionVariables.set('brandId', res.data.data[0].id);",
									"    console.log('Saved brandId: ' + res.data.data[0].id);",
									"} else {",
									"    console.warn('No brands found — car creation will require an existing brand (admin must seed data).');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/brands?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["brands"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				}
			]
		},
		{
			"name": "Admin Seed",
			"description": "Login as admin to seed reference data (brand) needed by car/travel/inscription tests. Cleaned up at the end.",
			"item": [
				{
					"name": "Admin Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - Admin login successful', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Response contains admin token', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('token');",
									"    pm.expect(data.token).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.token) {",
									"    pm.collectionVariables.set('adminToken', res.data.token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{adminEmail}}\",\n\t\"password\": \"{{adminPassword}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						}
					}
				},
				{
					"name": "Admin Create Brand",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 201 - Brand created', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Data contains brand id', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('id');",
									"    pm.expect(data.id).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.id) pm.collectionVariables.set('brandId', res.data.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{adminToken}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"Renault\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/brands",
							"host": ["{{baseUrl}}"],
							"path": ["brands"]
						}
					}
				}
			]
		},
		{
			"name": "Color",
			"item": [
				{
					"name": "Create Color",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 201 - Color created', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Data contains color id', function () {",
									"    const data = pm.response.json().data;",
									"    pm.expect(data).to.have.property('id');",
									"    pm.expect(data.id).to.be.a('string').and.not.empty;",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.id) pm.collectionVariables.set('colorId', res.data.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"Rouge\",\n\t\"hex\": \"#FF0000\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/colors",
							"host": ["{{baseUrl}}"],
							"path": ["colors"]
						}
					}
				},
				{
					"name": "List Colors",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is a non-empty array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array').and.not.empty;",
									"});",
									"",
									"pm.test('Pagination meta is present', function () {",
									"    const meta = pm.response.json().data.meta;",
									"    pm.expect(meta).to.have.property('page');",
									"    pm.expect(meta).to.have.property('total');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/colors?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["colors"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				},
				{
					"name": "Patch Color",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - Color updated', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"Bleu\",\n\t\"hex\": \"#0000FF\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/colors/{{colorId}}",
							"host": ["{{baseUrl}}"],
							"path": ["colors", "{{colorId}}"]
						}
					}
				}
			]
		},
		{
			"name": "Car",
			"item": [
				{
					"name": "Create Car",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Generate a unique license plate",
									"const plate = 'AB-' + Date.now().toString().slice(-3) + '-CD';",
									"pm.collectionVariables.set('licensePlate', plate);",
									"",
									"// If brandId is not set, try fetching from the API",
									"if (!pm.collectionVariables.get('brandId')) {",
									"    const baseUrl = pm.collectionVariables.get('baseUrl');",
									"    const token = pm.collectionVariables.get('token');",
									"    const bypass = pm.collectionVariables.get('bypassToken');",
									"    pm.sendRequest({",
									"        url: baseUrl + '/brands?page=1&limit=1',",
									"        method: 'GET',",
									"        header: {",
									"            'x-auth-token': token,",
									"            'x-vercel-protection-bypass': bypass",
									"        }",
									"    }, function(err, response) {",
									"        if (!err && response.code === 200) {",
									"            try {",
									"                const res = response.json();",
									"                const items = res.data && res.data.data ? res.data.data : [];",
									"                if (items.length > 0) {",
									"                    pm.collectionVariables.set('brandId', items[0].id);",
									"                }",
									"            } catch(e) { /* ignore */ }",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const brandId = pm.collectionVariables.get('brandId');",
									"",
									"if (!brandId) {",
									"    pm.test('SKIP - No brandId available (admin must seed brands)', function () {",
									"        console.warn('Cannot test car creation without an existing brand.');",
									"        pm.expect(true).to.be.true;",
									"    });",
									"} else {",
									"    pm.test('Status 201 - Car created', function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Data contains car id', function () {",
									"        const data = pm.response.json().data;",
									"        pm.expect(data).to.have.property('id');",
									"        pm.expect(data.id).to.be.a('string').and.not.empty;",
									"    });",
									"",
									"    const res = pm.response.json();",
									"    if (res.data && res.data.id) pm.collectionVariables.set('carId', res.data.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"model\": \"Clio\",\n\t\"brandId\": \"{{brandId}}\",\n\t\"licensePlate\": \"{{licensePlate}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/cars",
							"host": ["{{baseUrl}}"],
							"path": ["cars"]
						}
					}
				},
				{
					"name": "List Cars",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is an array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array');",
									"});",
									"",
									"pm.test('Pagination meta is present', function () {",
									"    const meta = pm.response.json().data.meta;",
									"    pm.expect(meta).to.have.property('page');",
									"    pm.expect(meta).to.have.property('total');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/cars?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["cars"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				},
				{
					"name": "Update Car (PUT)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const plate = 'EF-' + Date.now().toString().slice(-3) + '-GH';",
									"pm.collectionVariables.set('updatedPlate', plate);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const carId = pm.collectionVariables.get('carId');",
									"if (!carId) {",
									"    pm.test('SKIP - No carId (car creation was skipped)', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 200 - Car updated', function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Data reflects updated values', function () {",
									"        const data = pm.response.json().data;",
									"        pm.expect(data).to.be.an('object');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"model\": \"Megane\",\n\t\"brandId\": \"{{brandId}}\",\n\t\"licensePlate\": \"{{updatedPlate}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/cars/{{carId}}",
							"host": ["{{baseUrl}}"],
							"path": ["cars", "{{carId}}"]
						}
					}
				},
				{
					"name": "Patch Car",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const plate = 'IJ-' + Date.now().toString().slice(-3) + '-KL';",
									"pm.collectionVariables.set('patchedPlate', plate);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const carId = pm.collectionVariables.get('carId');",
									"if (!carId) {",
									"    pm.test('SKIP - No carId (car creation was skipped)', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 200 - Car patched', function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Data reflects patched values', function () {",
									"        const data = pm.response.json().data;",
									"        pm.expect(data).to.be.an('object');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"licensePlate\": \"{{patchedPlate}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/cars/{{carId}}",
							"host": ["{{baseUrl}}"],
							"path": ["cars", "{{carId}}"]
						}
					}
				}
			]
		},
		{
			"name": "Travel",
			"item": [
				{
					"name": "Create Travel",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const carId = pm.collectionVariables.get('carId');",
									"if (!carId) {",
									"    pm.test('SKIP - No carId (car creation was skipped)', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 201 - Travel created', function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Data contains travel id', function () {",
									"        const data = pm.response.json().data;",
									"        pm.expect(data).to.have.property('id');",
									"        pm.expect(data.id).to.be.a('string').and.not.empty;",
									"    });",
									"",
									"    const res = pm.response.json();",
									"    if (res.data && res.data.id) pm.collectionVariables.set('travelId', res.data.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"kms\": 465,\n\t\"date\": \"2026-03-15\",\n\t\"departureCity\": \"Paris\",\n\t\"arrivalCity\": \"Lyon\",\n\t\"seats\": 3,\n\t\"carId\": \"{{carId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/travels",
							"host": ["{{baseUrl}}"],
							"path": ["travels"]
						}
					}
				},
				{
					"name": "Get Travel",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const travelId = pm.collectionVariables.get('travelId');",
									"if (!travelId) {",
									"    pm.test('SKIP - No travelId (travel creation was skipped)', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 200', function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Data matches created travel', function () {",
									"        const data = pm.response.json().data;",
									"        pm.expect(data).to.have.property('id');",
									"        pm.expect(data.id).to.eql(pm.collectionVariables.get('travelId'));",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/travels/{{travelId}}",
							"host": ["{{baseUrl}}"],
							"path": ["travels", "{{travelId}}"]
						}
					}
				},
				{
					"name": "List Travels",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is an array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array');",
									"});",
									"",
									"pm.test('Pagination meta is present', function () {",
									"    const meta = pm.response.json().data.meta;",
									"    pm.expect(meta).to.have.property('page');",
									"    pm.expect(meta).to.have.property('total');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/travels?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["travels"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				},
				{
					"name": "Search Travel",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Data is a flat array (not paginated)', function () {",
									"    pm.expect(pm.response.json().data).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/travels/search?departureCity=Paris&arrivalCity=Lyon&date=2026-03-15",
							"host": ["{{baseUrl}}"],
							"path": ["travels", "search"],
							"query": [
								{ "key": "departureCity", "value": "Paris" },
								{ "key": "arrivalCity", "value": "Lyon" },
								{ "key": "date", "value": "2026-03-15" }
							]
						}
					}
				}
			]
		},
		{
			"name": "Inscription",
			"item": [
				{
					"name": "Create Inscription",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const travelId = pm.collectionVariables.get('travelId');",
									"if (!travelId) {",
									"    pm.test('SKIP - No travelId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 201 - Inscription created', function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Data contains inscription id', function () {",
									"        const data = pm.response.json().data;",
									"        pm.expect(data).to.have.property('id');",
									"        pm.expect(data.id).to.be.a('string').and.not.empty;",
									"    });",
									"",
									"    const res = pm.response.json();",
									"    if (res.data && res.data.id) pm.collectionVariables.set('inscriptionId', res.data.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"travelId\": \"{{travelId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/inscriptions",
							"host": ["{{baseUrl}}"],
							"path": ["inscriptions"]
						}
					}
				},
				{
					"name": "Create Inscription - Duplicate (expect 409)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const travelId = pm.collectionVariables.get('travelId');",
									"if (!travelId) {",
									"    pm.test('SKIP - No travelId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 409 - Already inscribed', function () {",
									"        pm.response.to.have.status(409);",
									"    });",
									"",
									"    pm.test('Response has success:false', function () {",
									"        pm.expect(pm.response.json().success).to.eql(false);",
									"    });",
									"",
									"    pm.test('Error code is ALREADY_INSCRIBED', function () {",
									"        pm.expect(pm.response.json().error.code).to.eql('ALREADY_INSCRIBED');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"travelId\": \"{{travelId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/inscriptions",
							"host": ["{{baseUrl}}"],
							"path": ["inscriptions"]
						}
					}
				},
				{
					"name": "List Inscriptions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is an array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array');",
									"});",
									"",
									"pm.test('Pagination meta is present', function () {",
									"    const meta = pm.response.json().data.meta;",
									"    pm.expect(meta).to.have.property('page');",
									"    pm.expect(meta).to.have.property('total');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/inscriptions?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["inscriptions"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				},
				{
					"name": "List User Inscriptions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success:true', function () {",
									"    pm.expect(pm.response.json().success).to.eql(true);",
									"});",
									"",
									"pm.test('Paginated data.data is an array', function () {",
									"    const payload = pm.response.json().data;",
									"    pm.expect(payload).to.have.property('data');",
									"    pm.expect(payload.data).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/users/{{userId}}/inscriptions?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["users", "{{userId}}", "inscriptions"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				},
				{
					"name": "List Travel Passengers",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const travelId = pm.collectionVariables.get('travelId');",
									"if (!travelId) {",
									"    pm.test('SKIP - No travelId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 200', function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test('Response has success:true', function () {",
									"        pm.expect(pm.response.json().success).to.eql(true);",
									"    });",
									"",
									"    pm.test('Paginated data.data is an array with passengers', function () {",
									"        const payload = pm.response.json().data;",
									"        pm.expect(payload).to.have.property('data');",
									"        pm.expect(payload.data).to.be.an('array').and.not.empty;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/travels/{{travelId}}/passengers?page=1&limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["travels", "{{travelId}}", "passengers"],
							"query": [
								{ "key": "page", "value": "1" },
								{ "key": "limit", "value": "20" }
							]
						}
					}
				}
			]
		},
		{
			"name": "Cleanup",
			"item": [
				{
					"name": "Delete Inscription",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const inscriptionId = pm.collectionVariables.get('inscriptionId');",
									"if (!inscriptionId) {",
									"    pm.test('SKIP - No inscriptionId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 204 - Inscription deleted', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/inscriptions/{{inscriptionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["inscriptions", "{{inscriptionId}}"]
						}
					}
				},
				{
					"name": "Delete Travel",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const travelId = pm.collectionVariables.get('travelId');",
									"if (!travelId) {",
									"    pm.test('SKIP - No travelId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 204 - Travel deleted', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/travels/{{travelId}}",
							"host": ["{{baseUrl}}"],
							"path": ["travels", "{{travelId}}"]
						}
					}
				},
				{
					"name": "Delete Car",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const carId = pm.collectionVariables.get('carId');",
									"if (!carId) {",
									"    pm.test('SKIP - No carId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 204 - Car deleted', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/cars/{{carId}}",
							"host": ["{{baseUrl}}"],
							"path": ["cars", "{{carId}}"]
						}
					}
				},
				{
					"name": "Delete Color",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const colorId = pm.collectionVariables.get('colorId');",
									"if (!colorId) {",
									"    pm.test('SKIP - No colorId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 204 - Color deleted', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/colors/{{colorId}}",
							"host": ["{{baseUrl}}"],
							"path": ["colors", "{{colorId}}"]
						}
					}
				},
				{
					"name": "Delete City (expect 403 - ADMIN only)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 403 - Requires ADMIN role', function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test('Response has success:false', function () {",
									"    pm.expect(pm.response.json().success).to.eql(false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/cities/{{cityId}}",
							"host": ["{{baseUrl}}"],
							"path": ["cities", "{{cityId}}"]
						}
					}
				},
				{
					"name": "Admin Login (cleanup)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 200 - Admin login for cleanup', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const res = pm.response.json();",
									"if (res.data && res.data.token) {",
									"    pm.collectionVariables.set('adminToken', res.data.token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"email\": \"{{adminEmail}}\",\n\t\"password\": \"{{adminPassword}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						}
					}
				},
				{
					"name": "Admin Delete Brand",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const brandId = pm.collectionVariables.get('brandId');",
									"if (!brandId) {",
									"    pm.test('SKIP - No brandId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 204 - Brand deleted', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{adminToken}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/brands/{{brandId}}",
							"host": ["{{baseUrl}}"],
							"path": ["brands", "{{brandId}}"]
						}
					}
				},
				{
					"name": "Admin Delete City",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const cityId = pm.collectionVariables.get('cityId');",
									"if (!cityId) {",
									"    pm.test('SKIP - No cityId', function () { pm.expect(true).to.be.true; });",
									"} else {",
									"    pm.test('Status 204 - City deleted', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{adminToken}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/cities/{{cityId}}",
							"host": ["{{baseUrl}}"],
							"path": ["cities", "{{cityId}}"]
						}
					}
				},
				{
					"name": "Anonymize User (GDPR)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 204 - User anonymized', function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/users/me",
							"host": ["{{baseUrl}}"],
							"path": ["users", "me"]
						}
					}
				},
				{
					"name": "Verify User anonymized (expect 404)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status 404 - User not found after anonymization', function () {",
									"    pm.response.to.have.status(404);",
									"});",
									"",
									"pm.test('Response has success:false', function () {",
									"    pm.expect(pm.response.json().success).to.eql(false);",
									"});",
									"",
									"pm.test('Error code is USER_NOT_FOUND', function () {",
									"    pm.expect(pm.response.json().error.code).to.eql('USER_NOT_FOUND');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{ "key": "x-auth-token", "value": "{{token}}" },
							{ "key": "x-vercel-protection-bypass", "value": "{{bypassToken}}" }
						],
						"url": {
							"raw": "{{baseUrl}}/users/{{userId}}",
							"host": ["{{baseUrl}}"],
							"path": ["users", "{{userId}}"]
						}
					}
				}
			]
		}
	]
}
